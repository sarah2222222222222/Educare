<html lang="en">
 <head>
  <meta charset="utf-8" />
  <meta content="width=device-width, initial-scale=1" name="viewport" />
  <title>Manual Create with Navigation to Generation Page</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link
    href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/all.min.css"
    rel="stylesheet"
  />
  <link
    href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600&display=swap"
    rel="stylesheet"
  />
  <style>
    body {
      font-family: "Inter", sans-serif;
      background-color: #f9fafb;
    }
    textarea::-webkit-scrollbar {
      width: 8px;
    }
    textarea::-webkit-scrollbar-thumb {
      background-color: #3b82f6;
      border-radius: 4px;
    }
     /* Floating larger AI companion */
     @keyframes float {
            0% {
                transform: translatey(0px);
            }
            50% {
                transform: translatey(-10px);
            }
            100% {
                transform: translatey(0px);
            }
        }
        .floating {
            animation: float 2s ease-in-out infinite;
        }

        .fade-in {
            animation: fadeIn 6s ease-in-out;
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
            }
            to {
                opacity: 1;
            }
        }

        .slide-in {
            animation: slideIn 1s ease-in-out;
        }

        @keyframes slideIn {
            from {
                transform: translateX(-100%);
            }
            to {
                transform: translateX(0);
            }
        }
  </style>
 </head>
 <body class="text-gray-900">
  <div class="flex min-h-screen">
   <!-- Left vertical sidebar -->
  
   <!-- Main content -->
   <main class="flex-1 p-8 max-w-5xl mx-auto">
    <!-- Top navigation tabs -->
    <nav
      class="inline-flex items-center bg-white border border-gray-300 rounded-xl shadow px-8 py-4 mb-10 w-full"
    >
     <a
       class="text-gray-600 text-sm font-semibold mr-12 hover:text-gray-900 transition"
       href="./stream.html"
       >Stream</a
     >
     <a
       class="text-blue-600 text-sm font-semibold mr-12 hover:text-blue-800 transition"
       href="./classwork.html"
       >Classwork</a
     >
     <a
       class="text-gray-600 text-sm font-semibold mr-12 hover:text-gray-900 transition"
       href="./people.html"
       >People</a
     >
     <a
       class="text-gray-600 text-sm font-semibold mr-12 hover:text-gray-900 transition"
       href="./Messages.html"
       >Messages</a
     >
     <a
       class="text-gray-600 text-sm font-semibold mr-12 hover:text-gray-900 transition"
       href="./calendar.html"
       >Calendar</a
     >
     <button
       aria-label="Settings"
       class="ml-auto text-blue-600 hover:text-blue-800 focus:outline-none transition"
     >
      <i class="fas fa-cog fa-lg"></i>
     </button>
    </nav>

    <!-- Navigation buttons to generation pages -->
     <a href="./generate-assignment.html">
    <section class="mb-12 bg-white rounded-2xl shadow-lg p-8 flex flex-col sm:flex-row gap-6 justify-center max-w-md mx-auto">
     <button
       id="goToGenerateAssessment"
       class="flex-1 bg-blue-600 text-white text-sm font-semibold rounded-lg px-6 py-4 hover:bg-blue-700 transition shadow-md"
       type="button"
       aria-label="Go to Generate Assessment Page">
      Generate Assessment
     </button>
     
     <button
       id="goToGenerateMaterial"
       class="flex-1 bg-green-600 text-white text-sm font-semibold rounded-lg px-6 py-4 hover:bg-green-700 transition shadow-md"
       type="button"
       aria-label="Go to Generate Material Page"
     >
      Generate Material
     </button>
    </section>
</a>

    <!-- Manual creation form with file upload -->
    <section class="mb-12 bg-white rounded-2xl shadow-lg p-8">
     <h1 class="text-2xl font-semibold mb-6 text-gray-800">
      Create Assessment or Material Manually
     </h1>
     <form id="manualForm" class="flex flex-col gap-6 max-w-2xl" enctype="multipart/form-data">
      <div>
       <label
         for="manualType"
         class="text-sm font-semibold text-gray-700 mb-2 block"
         >Select Type</label
       >
       <select
         id="manualType"
         name="manualType"
         class="border border-gray-300 rounded-lg px-4 py-3 text-sm w-full focus:outline-none focus:ring-2 focus:ring-blue-500 transition"
         required
       >
        <option value="" disabled selected>Select type</option>
        <option value="assessment">Assessment</option>
        <option value="material">Material</option>
       </select>
      </div>

      <div>
       <label
         for="manualTopic"
         class="text-sm font-semibold text-gray-700 mb-2 block"
         >Topic</label
       >
       <input
         type="text"
         id="manualTopic"
         name="manualTopic"
         placeholder="Enter topic or subject"
         class="border border-gray-300 rounded-lg px-4 py-3 text-sm w-full focus:outline-none focus:ring-2 focus:ring-blue-500 transition"
         required
       />
      </div>

      <div>
       <label
         for="manualTitle"
         class="text-sm font-semibold text-gray-700 mb-2 block"
         >Title</label
       >
       <input
         type="text"
         id="manualTitle"
         name="manualTitle"
         placeholder="Enter title"
         class="border border-gray-300 rounded-lg px-4 py-3 text-sm w-full focus:outline-none focus:ring-2 focus:ring-blue-500 transition"
         required
       />
      </div>

      <div>
       <label
         for="manualContent"
         class="text-sm font-semibold text-gray-700 mb-2 block"
         >Content</label
       >
       <textarea
         id="manualContent"
         name="manualContent"
         rows="8"
         placeholder="Enter the content of the assessment or material"
         class="border border-gray-300 rounded-lg px-4 py-3 text-sm w-full focus:outline-none focus:ring-2 focus:ring-blue-500 resize-y transition"
         required
       ></textarea>
      </div>

      <div>
       <label
         for="fileUpload"
         class="text-sm font-semibold text-gray-700 mb-2 block"
         >Upload Files (from device or Google Drive)</label
       >
       <input
         type="file"
         id="fileUpload"
         name="fileUpload"
         multiple
         class="block w-full text-sm text-gray-600 file:mr-4 file:py-2 file:px-4 file:rounded-lg file:border-0 file:text-sm file:font-semibold file:bg-blue-50 file:text-blue-700 hover:file:bg-blue-100 focus:outline-none focus:ring-2 focus:ring-blue-500 transition"
       />
       <p class="text-xs text-gray-500 mt-1">
        You can upload multiple files. Supported: PDFs, images, docs, etc.
       </p>
      </div>

      <div class="flex justify-end gap-4">
       <button
         type="reset"
         class="text-blue-600 text-sm font-semibold hover:underline focus:outline-none"
       >
        Clear
       </button>
       <button
         type="submit"
         class="bg-blue-600 text-white text-sm font-semibold rounded-lg px-6 py-3 hover:bg-blue-700 transition"
       >
        Publish
       </button>
      </div>
     </form>
    </section>

    <!-- Published items list -->
    <section class="bg-white rounded-2xl shadow-lg p-8">
     <h1 class="text-2xl font-semibold mb-6 text-gray-800">Published Items</h1>
     <div
       id="publishedList"
       class="divide-y divide-gray-200 border border-gray-300 rounded-xl"
     >
      <!-- Published items will appear here -->
     </div>
    </section>
   </main>
   <!-- Floating Avatar bottom right -->
   <div class="fixed bottom-4 right-4 floating">
    <a href="#" onclick="openModal()">
     <img alt="AI icon" class="w-20 h-20 rounded-full" src="../assets/Images/WhatsApp Image 2024-11-15 at 19.39.33_b2a01f1c.jpg"/>
    </a>
   </div>
  </div>

  <script>
   // Elements
    const goToGenerateAssessmentBtn = document.getElementById(
      "goToGenerateAssessment"
    );
    const goToGenerateMaterialBtn = document.getElementById("goToGenerateMaterial");
    const manualForm = document.getElementById("manualForm");
    const publishedList = document.getElementById("publishedList");

    let currentEditingId = null;

    // Navigation handlers
    goToGenerateAssessmentBtn.addEventListener("click", () => {
      // Navigate to your assessment generation page
      window.location.href = "../generate-assignment.html";
    });
    goToGenerateMaterialBtn.addEventListener("click", () => {
      // Navigate to your material generation page
      window.location.href = "../generate-assignment.html";
    });

    // Generate unique ID
    function generateId() {
      return "id-" + Math.random().toString(36).substr(2, 9);
    }

    // Convert uploaded files to base64 strings for storage (simulate upload)
    function readFilesAsBase64(files) {
      return Promise.all(
        Array.from(files).map(
          (file) =>
            new Promise((resolve, reject) => {
              const reader = new FileReader();
              reader.onload = () => {
                resolve({
                  name: file.name,
                  type: file.type,
                  size: file.size,
                  data: reader.result,
                });
              };
              reader.onerror = () => reject(reader.error);
              reader.readAsDataURL(file);
            })
        )
      );
    }

    // Load published items from localStorage
    function loadPublishedItems() {
      const items = JSON.parse(localStorage.getItem("publishedItems")) || [];
      publishedList.innerHTML = "";
      if (items.length === 0) {
        publishedList.innerHTML =
          '<p class="p-6 text-sm text-gray-500 text-center">No published items yet.</p>';
        return;
      }
      items.forEach((item) => {
        const div = document.createElement("div");
        div.className =
          "flex flex-col md:flex-row md:items-center justify-between p-5 hover:bg-gray-100 transition cursor-default gap-3 md:gap-0";
        div.innerHTML = `
          <div class="flex items-center gap-4 flex-1 min-w-0">
            <img
              src="${
                item.type === "assessment"
                  ? "https://storage.googleapis.com/a1aa/image/10428954-0d08-4c8b-a40b-a0f516d7cebe.jpg"
                  : "https://storage.googleapis.com/a1aa/image/87de08da-f092-4732-6d05-7603384b4870.jpg"
              }"
              alt="${
                item.type === "assessment"
                  ? "Assessment icon"
                  : "Material icon"
              }"
              width="40"
              height="40"
              class="rounded-full shadow-sm flex-shrink-0"
            />
            <div class="min-w-0">
              <p class="text-sm font-semibold text-gray-800 truncate">${item.title}</p>
              <p class="text-xs text-gray-500 italic truncate">${item.topic}</p>
              ${
                item.files && item.files.length > 0
                  ? `<div class="mt-1 flex flex-wrap gap-2 overflow-x-auto max-w-full">
                      ${item.files
                        .map(
                          (f) =>
                            `<a href="${f.data}" download="${f.name}" class="text-blue-600 text-xs underline truncate max-w-[150px]" title="${f.name}">${f.name}</a>`
                        )
                        .join("")}
                    </div>`
                  : ""
              }
            </div>
          </div>
          <button
            class="text-blue-600 text-sm font-semibold hover:underline focus:outline-none edit-btn flex-shrink-0"
            data-id="${item.id}"
            aria-label="Edit published item"
          >
            Edit
          </button>
        `;
        publishedList.appendChild(div);
      });
    }

    // Reset form to default state
    function resetForm() {
      manualForm.reset();
      currentEditingId = null;
      manualForm.querySelector("button[type=submit]").textContent = "Publish";
    }

    // Handle form submit for create or edit
    manualForm.addEventListener("submit", async (e) => {
      e.preventDefault();

      const type = manualForm.manualType.value;
      const topic = manualForm.manualTopic.value.trim();
      const title = manualForm.manualTitle.value.trim();
      const content = manualForm.manualContent.value.trim();
      const filesInput = manualForm.fileUpload;

      if (!type || !topic || !title || !content) {
        alert("Please fill in all required fields.");
        return;
      }

      let filesData = [];
      if (filesInput.files.length > 0) {
        try {
          filesData = await readFilesAsBase64(filesInput.files);
        } catch (err) {
          alert("Error reading files: " + err.message);
          return;
        }
      }

      const publishedItems =
        JSON.parse(localStorage.getItem("publishedItems")) || [];

      if (currentEditingId) {
        // Edit existing
        const index = publishedItems.findIndex((i) => i.id === currentEditingId);
        if (index !== -1) {
          publishedItems[index] = {
            id: currentEditingId,
            type,
            topic,
            title,
            content,
            files: filesData.length > 0 ? filesData : publishedItems[index].files || [],
          };
        }
        alert("Item updated successfully.");
      } else {
        // New item
        publishedItems.push({
          id: generateId(),
          type,
          topic,
          title,
          content,
          files: filesData,
        });
        alert("Item published successfully.");
      }

      localStorage.setItem("publishedItems", JSON.stringify(publishedItems));
      loadPublishedItems();
      resetForm();
    });

    // Edit published item on click
    publishedList.addEventListener("click", (e) => {
      if (!e.target.classList.contains("edit-btn")) return;
      const id = e.target.getAttribute("data-id");
      const publishedItems =
        JSON.parse(localStorage.getItem("publishedItems")) || [];
      const item = publishedItems.find((i) => i.id === id);
      if (!item) return;

      currentEditingId = id;
      manualForm.manualType.value = item.type;
      manualForm.manualTopic.value = item.topic;
      manualForm.manualTitle.value = item.title;
      manualForm.manualContent.value = item.content;
      manualForm.querySelector("button[type=submit]").textContent = "Save Changes";

      // Clear file input (cannot set value programmatically for security)
      manualForm.fileUpload.value = "";

      window.scrollTo({ top: 0, behavior: "smooth" });
    });

    // Initial load
    window.addEventListener("DOMContentLoaded", () => {
      loadPublishedItems();
    });
  </script>
 </body>
</html>